# Configuration
  # Remap prefix from 'C-b' to 'C-a'
  set -g prefix C-q
  bind-key q send-prefix

  # Enable mouse mode (tmux 2.1 and above)
  set -g mouse on

  # don't rename windows automatically
  set-option -g allow-rename off

  # So I don't have escape up pb on vi
  set-option -s escape-time 0

  # Vim mode copy mode
  set-window-option -g mode-keys vi

  # Drag windows on the status bar
  bind-key -n MouseDrag1Status swap-window -t=


# Preferences
  # Increase scrollback 2000 default, too much use lot of ram
  set-option -g history-limit 50000

  # Set history file so keep commands
  set-option -sg history-file ~/.tmux_history

  # I dont care ? | pwd & date
  set-option -g status-right ''

  # Keep title : [Session] Title (of Pane)
  set-option -g set-titles-string "[#S] #T"
  set-option -g set-titles on

  # Pane border: status top is annnoying
  set -g pane-border-status off
  # Pane border: defautl is white
  set -g pane-border-style fg=green
  # Pane border: active yellow -> get faster eye on cursor
  set -g pane-active-border-style "bg=default fg=yellow"

  # Status bar
  set-option -g status-style fg=colour136,bg=colour235
  # default window title colors
  set-window-option -g window-status-style fg=colour244,bg=default
  # active window title colors
  set-window-option -g window-status-current-style fg=colour166,bg=default


# Binding normal mode
  # Split panes using | and -
  bind | split-window -h -c "#{pane_current_path}"
  bind - split-window -v -c "#{pane_current_path}"
  bind _ split-window -v -c "#{pane_current_path}"

  # New window same path
  bind c new-window -c "#{pane_current_path}"

  # Cycle pane (defautl <c-o>
  bind-key q select-pane -t :.+
  bind-key C-q select-pane -t :.+

  # hjkl to move between panes (never used)
  bind h select-pane -L
  bind j select-pane -D
  bind k select-pane -U
  bind l select-pane -R

  # Source
  bind r source-file ~/.tmux.conf \; display-message 'tmux conf sourced'

  # Clipboard
  bind C-y run-shell "tmux save-buffer - | xclip -i -r -selection clipboard > /dev/null" \; display-message "Copied tmux buffer to clipboard"
  bind C-p run "xclip -o | tmux load-buffer - ; tmux paste-buffer"


# Binding root mode
  # switch panes using Alt-arrow without prefix
  bind -n M-Left select-pane -L
  bind -n M-Right select-pane -R
  bind -n M-Up select-pane -U
  bind -n M-Down select-pane -D

  bind -n M-h select-pane -L
  bind -n M-l select-pane -R
  bind -n M-k select-pane -U
  bind -n M-j select-pane -D


# Binding copy mode
  # Trigger copy mode by Alt up
  bind -n M-Up copy-mode

  # Mouse select line (without new line)
  bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line \; send-keys h

  bind-key -T copy-mode-vi Escape send-keys -X  cancel		# exit copy mode; or hit q default enter
  bind-key -T copy-mode-vi y send-keys -X copy-selection		# yank defautl enter
  bind-key -T copy-mode-vi v send-keys -X begin-selection		# begin visual mode; default <sapce>
  bind-key -T copy-mode-vi V send-keys -X select-line		# visual line
  bind-key -T copy-mode-vi r send-keys -X rectangle-toggle 		# visual block toggle


# Test
  # Mouse middle and triple click
  bind-key -T root  TripleClick1Pane     select-pane -t = \;   copy-mode -M \; send-keys -X select-line \; send-keys h  # TrippleCLick select
  bind-key -T copy-mode-vi MouseDown2Pane send-keys -X copy-selection-and-cancel \; send-keys -X paste-buffer \; 		# Middle click paste
  bind-key -T root  MouseDown2Pane paste-buffer
  # Vim quick edit
  # bind-key v new-window -c "#{pane_current_path}" vi
  bind-key t new-window -c "#{pane_current_path}" 'cd ~/wiki/todo ; vi -c"call Windex(2)"' \; move-window -t 9
  bind-key w new-window -c "#{pane_current_path}" 'cd ~/wiki/wiki ; vi -c"call Windex(1)"' \; move-window -t 8

set-option -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"


# Resize panes with arrow keys because alt-arrow keys doesn't work
bind-key -r Up    resize-pane -U
bind-key -r Down  resize-pane -D
bind-key -r Left  resize-pane -L
bind-key -r Right resize-pane -R

# urlscan as context and url view
# install urlscan with 
# pip install urlscan
bind-key u capture-pane \; save-buffer $TMPDIR/tmux-buffer \; \
new-window -n "urlscan" '$SHELL -c "urlscan < $TMPDIR/tmux-buffer"'

# Make scrolling in less and similar programms work in termux without using arrow keys
# Run this to install
# git clone https://github.com/nhdaly/tmux-better-mouse-mode ~/.tmux/plugins/tmux-better-mouse-mode
# termux-fix-shebang ~/.tmux/plugins/tmux-better-mouse-mode/scroll_copy_mode.tmux

set -g @scroll-without-changing-pane on
set -g @scroll-speed-num-lines-per-scroll 1
set -g @emulate-scroll-for-no-mouse-alternate-buffer on
run-shell ~/.tmux/plugins/tmux-better-mouse-mode/scroll_copy_mode.tmux


